
extends ../layouts/default.jade

include ../mixins/mutable-fields.jade
include ../mixins/citations.jade

block jsState
    script.testignore meta = 
        != JSON.stringify(meta)

    script.testignore
        | function popup() {
        |    popupS.modal({
        |         content: '<div class="form-group"><label for="share">Copy the following link to share</label><input id="share" type="text" class="form-control" style="width:30em;" readonly value="#{share}"/></div>',
        |     });
        | }

block breadcrumbs
    ul
        li.inactive
            span.fa.fa-eye
            |  View

block content

    div.clearfix

    div.submission-detail.container-fluid

        div.row.entry-heading
            div.col-sm-8.entry-title
                h1(class=meta.canUpdate ? "edit edit-title" : "" ) !{meta.name ? meta.name : meta.id}
                    if meta.sbhBookmark && meta.sbhBookmark.description == 'true'
                        a(href='http://wiki.synbiohub.org/Terms/synbiohub#bookmark',title='Bookmarked Parts')
                            span.fa.fa-bookmark
                    if meta.sbhStar && meta.sbhStar.description == 'true'
                        a(href='http://wiki.synbiohub.org/Terms/synbiohub#star',title='Starred Parts')
                            span.fa.fa-star

                if locals.meta.remote && locals.meta.remote.url && locals.meta.remote.name
                    h4 #{'Mirrored from '}
                        a(href=locals.meta.remote.url,title='Edit in ' + locals.meta.remote.name) #{locals.meta.remote.name}

                if meta.id && meta.id != ''
                    h3 #{meta.id}
                        a(href='/search/displayId=\''+meta.id+'\'&',title='Find all records with the same identifier') 
                            span.fa.fa-search 
                        if meta.version && meta.version != ''
                            != 'Version '+meta.version
                            a(href='/search/persistentIdentity=<'+encodeURIComponent(meta.pid)+'>&',title='Find all versions') 
                                span.fa.fa-search 
                        if rdfType
                            h4 #{rdfType.name}
                                | 
                                a(href=rdfType.url,title='Learn more about this RDF type')
                                    span.fa.fa-info-circle
                else 
                        if rdfType
                            h4 #{rdfType.name} 
                                a(href=rdfType.url,title='Learn more about this RDF type')
                                    span.fa.fa-info-circle

                if meta.igemDiscontinued && meta.igemDiscontinued.description == 'true'
                    h4(style=" color: #FF0000") This part has been discontinued.
                if meta.isReplacedBy && meta.isReplacedBy.uri != ''
                    h4(style=" color: #FF0000") Please consider using 
                        a(href=meta.isReplacedBy.uri) #{meta.isReplacedBy.id}
                        | as a replacement.

            if (collectionIcon)
                div.col-sm-4.sbh-collection-icon
                    img(src=collectionIcon)

        div.row
            div.col-md-11

                if meta.wasDerivedFroms && meta.wasDerivedFroms.length > 0
                    for wasDerivedFrom in meta.wasDerivedFroms
                        h5 Source: 
                            div(class=meta.canUpdate ? "edit edit-multiple edit-wasDerivedFrom" : "", editText=wasDerivedFrom.url.toString(), style="display: contents")
                                a(href=wasDerivedFrom.url) #{wasDerivedFrom.uri}
                else if meta.canUpdate
                    h5 Source: 
                        div(class=meta.canUpdate ? "edit edit-multiple edit-wasDerivedFrom" : "", editText='', style="display: contents")

                if meta.wasGeneratedBys
                    for wasGeneratedBy in meta.wasGeneratedBys
                        h5 Generated By: 
                            a(href=wasGeneratedBy.url) #{wasGeneratedBy.uri}

                if meta.creator && meta.creator.description && meta.creator.description != ''
                    h5 Created by: 
                        != meta.creator.description
                        a(href='/search/dc:creator=\''+meta.creator.description+'\'&',title='Find all records created by this person') 
                            span.fa.fa-search
       
                if meta.created && meta.created.description && meta.created.description != ''
                    h5.testignore Date created: 
                        != meta.created.description
                        a(href='/search/createdBefore='+meta.created.description.split(' ')[0]+'&createdAfter='+meta.created.description.split(' ')[0]+'&',title='Find all records created on this date') 
                            span.fa.fa-search

                if meta.modified && meta.modified.description && meta.modified.description != ''
                    h5.testignore Date modified: 
                        != meta.modified.description 
                        a(href='/search/modifiedBefore='+meta.modified.description.split(' ')[0]+'&modifiedAfter='+meta.modified.description.split(' ')[0]+'&',title='Find all records modified on this date') 
                            span.fa.fa-search

                if (meta.description && meta.description != '') || meta.canUpdate 
                    h4(class=meta.canUpdate ? "edit edit-description" : "")
                        != meta.description
                        if meta.description && meta.description != ''
                            a(href='/search/?q='+meta.description.replace('<br/>',' '),title='Find all records with terms in common with this description')
                                span.fa.fa-search

                block topLevelBelowTitle

        block topLevelLarge

        block generalTopLevelButtons

        block topLevelPreview

        .container
            #accordion.panel-group
                .panel.panel-default
                    .panel-heading
                        h4.panel-title
                            a.accordion-toggle(data-toggle='collapse', href='#collapseDetails')
                                | <b>Details</b>
                    #collapseDetails.panel-collapse.collapse.in
                        .panel-body
                            table.table.table-striped.entry-detail-table

                                if meta.labels && meta.labels.length > 0
                                    tr
                                        td Labels
                                        td #{meta.labels.join(', ')}

                                if meta.types && meta.types.length > 0
                                    tr
                                        td 
                                            | Types
                                            a(href='http://sbols.org/v2#type',title='Learn more about types') 
                                                span.fa.fa-info-circle
                                        td 
                                            for type in meta.types
                                                if type.description 
                                                    div(class=meta.canUpdate ? "edit edit-multiple edit-type" : "", editText=type.uri, style="display: contents")
                                                        != type.description.name
                                                    a(href=type.term,title='Learn more about this type') 
                                                        span.fa.fa-info-circle
                                                    a(href='/search/type=<'+encodeURIComponent(type.uri)+'>&',title='Find all records with this type') 
                                                        span.fa.fa-search
                                                else 
                                                    div(class = meta.canUpdate ? "edit edit-multiple edit-type" : "", editText=type.uri, style="display: contents")
                                                        != type.uri 
                                                    a(href=type.uri,title='Learn more about this type') 
                                                        span.fa.fa-info-circle
                                                    a(href='/search/type=<'+encodeURIComponent(type.uri)+'>&',title='Find all records with this type') 
                                                        span.fa.fa-search
                                                br

                                if meta.roles && (meta.roles.length > 0 || meta.canUpdate)
                                    tr
                                        td 
                                            | Roles
                                            a(href='http://sbols.org/v2#role',title='Learn more about roles') 
                                                span.fa.fa-info-circle
                                        td
                                            if meta.roles && meta.roles.length > 0
                                                for role in meta.roles
                                                    if role.description
                                                        div(class=meta.canUpdate ? "edit edit-multiple edit-role" : "", editText=role.uri, style="display: contents")
                                                            != role.description.name
                                                        a(href=role.uri,title='Learn more about this role') 
                                                            span.fa.fa-info-circle
                                                        a(href='/search/role=<'+encodeURIComponent(role.uri)+'>&',title='Find all records with this role') 
                                                            span.fa.fa-search
                                                    else 
                                                        div(class=meta.canUpdate ? "edit edit-multiple edit-role" : "", editText=role.uri, style="display: contents")
                                                            != role.term 
                                                        a(href=role.uri,title='Learn more about this role') 
                                                            span.fa.fa-info-circle
                                                        a(href='/search/role=<'+encodeURIComponent(role.uri)+'>&',title='Find all records with this role') 
                                                            span.fa.fa-search
                                                    br
                                            else if meta.canUpdate
                                                div(class=meta.canUpdate ? "edit edit-multiple edit-role" : "", style="display: contents")

                                block topLevelPropertyTable

                            block topLevelBelowPropertyTable
                            +mutable-description(meta.mutableDescriptionSource, meta.mutableDescription, meta.canEdit)
                            +mutable-notes(meta.mutableNotesSource, meta.mutableNotes, meta.canEdit)
                            +mutable-source(meta.sourceSource, meta.source, meta.canEdit)
                            +citations(citationsSource, submissionCitations, meta.canEdit)
            block topLevelPanels
                
            block topLevelPanelsMeasured
		
            if meta.annotations && meta.annotations.length > 0
                .panel.panel-default
                    .panel-heading
                        h4.panel-title
                            a.accordion-toggle(data-toggle='collapse', href='#collapseOther', class='collapsed')
                                | <b>Other Properties</b>
                    #collapseOther.panel-collapse.collapse
                        .panel-body
                            div.row
                                div.col-md-12
                                    table.table.table-striped.entry-detail-table
                                        for annotation in meta.annotations
                                            tr
                                                td #{annotation.name}
                                                    a(href=annotation.nameDef,title='Learn more about this annotation type') 
                                                        span.fa.fa-info-circle
                                                if (annotation.type === 'uri')
                                                    td 
                                                        div(class=meta.canUpdate ? "edit edit-multiple edit-annotation" : "", editText=annotation.uri, editPred=annotation.nameDef, style="display: contents")
                                                            != annotation.value
                                                        a(href=annotation.url,title='Learn more about this annotation value') 
                                                            span.fa.fa-info-circle &nbsp;
                                                        a(href = '/search/<' + encodeURIComponent(annotation.nameDef) + '>=<' + encodeURIComponent(annotation.uri) + '>&', title = 'Find all records with this annotation')
                                                            span.fa.fa-search
                                                        if(meta.canEdit && annotation.removeOwner)
                                                            form.form-inline(style="display: inline" method='POST', action=annotation.removeOwner)
                                                                input(type='hidden' name='userUri' value=config.databasePrefix + annotation.value)
                                                                button.fakelink(type='submit')
                                                                    | &nbsp;
                                                                    span.fa.fa-trash
                                                else 
                                                    td
                                                        div(class=meta.canUpdate ? "edit edit-multiple edit-annotation" : "", editText=annotation.value, editPred=annotation.nameDef, style="display: contents")
                                                            != annotation.value 
                                                        a(href = '/search/<' + encodeURIComponent(annotation.nameDef) + '>=' + encodeURIComponent('\''+annotation.value.replace('\'','\\\'')+'\'') + '&', title = 'Find all records with this annotation')
                                                            span.fa.fa-search
            block topLevelPanelsCont
